<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>个人中心</title>
    <link rel="stylesheet" href="https://unpkg.com/element-ui/lib/theme-chalk/index.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/css/all.min.css">
    <link rel="stylesheet" href="../css/style.css">
</head>
<body>
    <div id="userCenter">
        <!-- 导航栏 -->
        <el-menu mode="horizontal" class="nav">
            <el-menu-item index="1" @click="goToHome">
                <i class="el-icon-s-home"></i> 返回首页
            </el-menu-item>
        </el-menu>

        <div class="user-center-container">
            <!-- 左侧菜单 -->
            <el-menu
                class="user-menu"
                :default-active="activeMenu"
                @select="handleSelect">
                <el-menu-item index="profile">
                    <i class="el-icon-user"></i>
                    <span>个人资料</span>
                </el-menu-item>
                <el-menu-item index="orders">
                    <i class="el-icon-tickets"></i>
                    <span>我的订单</span>
                </el-menu-item>
                <el-menu-item index="favorites">
                    <i class="el-icon-star-on"></i>
                    <span>我的收藏</span>
                </el-menu-item>
                <el-menu-item index="history">
                    <i class="el-icon-time"></i>
                    <span>浏览历史</span>
                </el-menu-item>
            </el-menu>

            <!-- 右侧内容区 -->
            <div class="content-area">
                <!-- 个人资料 -->
                <div v-show="activeMenu === 'profile'" class="profile-section">
                    <el-card>
                        <div slot="header">
                            <span>个人资料</span>
                            <el-button 
                                style="float: right; padding: 3px 0" 
                                type="text"
                                @click="editProfile">
                                编辑资料
                            </el-button>
                        </div>
                        <el-form :model="userInfo" label-width="80px" :disabled="!isEditing">
                            <el-form-item label="头像">
                                <el-avatar 
                                    :size="80"
                                    :src="userInfo.avatar"
                                    icon="el-icon-user-solid">
                                    {{ userInfo.username.charAt(0).toUpperCase() }}
                                </el-avatar>
                            </el-form-item>
                            <el-form-item label="用户名">
                                <el-input v-model="userInfo.username"></el-input>
                            </el-form-item>
                            <el-form-item label="邮箱">
                                <el-input v-model="userInfo.email"></el-input>
                            </el-form-item>
                            <el-form-item label="手机号">
                                <el-input v-model="userInfo.phone"></el-input>
                            </el-form-item>
                            <el-form-item v-if="isEditing">
                                <el-button type="primary" @click="saveProfile">保存</el-button>
                                <el-button @click="cancelEdit">取消</el-button>
                            </el-form-item>
                        </el-form>
                    </el-card>
                </div>

                <!-- 订单列表 -->
                <div v-show="activeMenu === 'orders'" class="orders-section">
                    <el-card>
                        <div slot="header" class="orders-header">
                            <span>我的订单</span>
                            <div class="header-actions">
                                <el-button 
                                    type="danger" 
                                    size="small" 
                                    :disabled="selectedOrders.length === 0"
                                    @click="handleBatchDeleteOrders">
                                    批量删除
                                </el-button>
                            </div>
                        </div>
                        
                        <el-table
                            v-loading="ordersLoading"
                            :data="orders"
                            @selection-change="handleOrderSelectionChange">
                            <el-table-column type="selection" width="55"></el-table-column>
                            <el-table-column prop="id" label="订单号" width="120"></el-table-column>
                            <el-table-column prop="date" label="下单时间" width="120"></el-table-column>
                            <el-table-column prop="title" label="商品名称"></el-table-column>
                            <el-table-column prop="amount" label="金额" width="100">
                                <template slot-scope="scope">
                                    ¥{{scope.row.amount}}
                                </template>
                            </el-table-column>
                            <el-table-column prop="status" label="状态" width="100">
                                <template slot-scope="scope">
                                    <el-tag :type="scope.row.status === '已支付' ? 'success' : 'warning'">
                                        {{scope.row.status}}
                                    </el-tag>
                                </template>
                            </el-table-column>
                            <el-table-column label="操作" width="150" align="center">
                                <template slot-scope="scope">
                                    <el-button 
                                        type="text" 
                                        size="small" 
                                        @click="viewOrder(scope.row)">
                                        查看详情
                                    </el-button>
                                    <el-button 
                                        v-if="scope.row.status !== '已支付'"
                                        type="text" 
                                        size="small" 
                                        class="danger-text"
                                        @click="cancelOrder(scope.row)">
                                        取消订单
                                    </el-button>
                                </template>
                            </el-table-column>
                        </el-table>

                        <!-- 空状态 -->
                        <el-empty
                            v-if="orders.length === 0"
                            description="暂无订单">
                        </el-empty>
                    </el-card>
                </div>

                <!-- 收藏列表 -->
                <div v-show="activeMenu === 'favorites'" class="favorites-section">
                    <el-card>
                        <div slot="header" class="favorites-header">
                            <span>我的收藏</span>
                            <div class="header-actions">
                                <el-button 
                                    type="danger" 
                                    size="small" 
                                    :disabled="selectedFavorites.length === 0"
                                    @click="handleBatchOperation('remove')">
                                    批量删除
                                </el-button>
                            </div>
                        </div>
                        
                        <!-- 收藏列表 -->
                        <el-table
                            v-loading="favoritesLoading"
                            :data="favorites"
                            @selection-change="handleSelectionChange">
                            <el-table-column type="selection" width="55"></el-table-column>
                            <el-table-column label="收藏内容">
                                <template slot-scope="scope">
                                    <div class="favorite-item">
                                        <img :src="scope.row.image" class="favorite-image">
                                        <div class="favorite-info">
                                            <h3>{{scope.row.title}}</h3>
                                            <p>{{scope.row.description}}</p>
                                            <span class="add-time">收藏于 {{formatTime(scope.row.addTime)}}</span>
                                        </div>
                                    </div>
                                </template>
                            </el-table-column>
                            <el-table-column label="操作" width="150" align="center">
                                <template slot-scope="scope">
                                    <el-button 
                                        type="text" 
                                        size="small" 
                                        @click="viewFavorite(scope.row)">
                                        查看详情
                                    </el-button>
                                    <el-button 
                                        type="text" 
                                        size="small" 
                                        class="danger-text"
                                        @click="removeFavorite(scope.row)">
                                        取消收藏
                                    </el-button>
                                </template>
                            </el-table-column>
                        </el-table>

                        <!-- 空状态 -->
                        <el-empty
                            v-if="favorites.length === 0"
                            description="暂无收藏内容">
                            <el-button type="primary" @click="goToHome">去首页逛逛</el-button>
                        </el-empty>
                    </el-card>
                </div>

                <!-- 浏览历史 -->
                <div v-show="activeMenu === 'history'" class="history-section">
                    <el-card>
                        <div slot="header">
                            <span>浏览历史</span>
                            <el-button 
                                style="float: right; padding: 3px 0" 
                                type="text"
                                @click="clearHistory">
                                清空历史
                            </el-button>
                        </div>
                        <el-timeline>
                            <el-timeline-item
                                v-for="(item, index) in history"
                                :key="index"
                                :timestamp="item.time">
                                <el-card>
                                    <h4>{{item.title}}</h4>
                                    <p>{{item.description}}</p>
                                    <el-button type="text" @click="viewHistory(item)">
                                        重新查看
                                    </el-button>
                                </el-card>
                            </el-timeline-item>
                        </el-timeline>
                    </el-card>
                </div>
            </div>
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/vue@2.6.14"></script>
    <script src="https://unpkg.com/element-ui/lib/index.js"></script>
    <script src="../js/user-center.js"></script>
</body>
</html> 